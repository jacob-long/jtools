<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Pearson correlations with complex survey data — svycor • jtools</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Lato-0.4.9/font.css" rel="stylesheet"><link href="../deps/IBM_Plex_Mono-0.4.9/font.css" rel="stylesheet"><link href="../deps/Raleway-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Calculate Pearson correlations with complex survey data — svycor"><meta name="description" content="svycor extends the survey package by calculating correlations
with syntax similar to the original package, which for reasons unknown lacks
such a function."><meta property="og:description" content="svycor extends the survey package by calculating correlations
with syntax similar to the original package, which for reasons unknown lacks
such a function."><meta property="og:image" content="/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">jtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> News</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-code-o"></span> Documentation</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-book"></span> Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/summ.html">Tools for summarizing and visualizing regression models</a></li>
    <li><a class="dropdown-item" href="../articles/effect_plot.html">Visualizing regression model predictions</a></li>
    <li><a class="dropdown-item" href="../articles/svycor.html">Calculate correlations and correlation tables with complex survey data</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/jacob-long/jtools"><span class="fa fa-github fa-lg"></span> Github</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate Pearson correlations with complex survey data</h1>
      <small class="dont-index">Source: <a href="https://github.com/jacob-long/jtools/blob/master/R/svytools.R" class="external-link"><code>R/svytools.R</code></a></small>
      <div class="d-none name"><code>svycor.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>svycor</code> extends the <code>survey</code> package by calculating correlations
with syntax similar to the original package, which for reasons unknown lacks
such a function.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">svycor</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">design</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"jtools-digits"</span>, default <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  sig.stats <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  bootn <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  mean1 <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>A formula (e.g., ~var1+var2) specifying the terms to correlate.</p></dd>


<dt id="arg-design">design<a class="anchor" aria-label="anchor" href="#arg-design"></a></dt>
<dd><p>The <code>survey.design</code> or <code>svyrep.design</code> object.</p></dd>


<dt id="arg-na-rm">na.rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p>Logical. Should cases with missing values be dropped?</p></dd>


<dt id="arg-digits">digits<a class="anchor" aria-label="anchor" href="#arg-digits"></a></dt>
<dd><p>An integer specifying the number of digits past the decimal to
report in the output. Default is 2. You can change the default number of
digits for all jtools functions with
<code>options("jtools-digits" = digits)</code> where digits is the desired number.</p></dd>


<dt id="arg-sig-stats">sig.stats<a class="anchor" aria-label="anchor" href="#arg-sig-stats"></a></dt>
<dd><p>Logical. Perform non-parametric bootstrapping
(using <code><a href="https://rdrr.io/pkg/weights/man/wtd.cor.html" class="external-link">wtd.cor</a></code>) to generate standard errors and
associated t- and p-values. See details for some considerations when doing
null hypothesis testing with complex survey correlations.</p></dd>


<dt id="arg-bootn">bootn<a class="anchor" aria-label="anchor" href="#arg-bootn"></a></dt>
<dd><p>If <code>sig.stats</code> is TRUE, this defines the number of
bootstraps to be run to generate the standard errors and p-values. For
large values and large datasets, this can contribute considerably to
processing time.</p></dd>


<dt id="arg-mean-">mean1<a class="anchor" aria-label="anchor" href="#arg-mean-"></a></dt>
<dd><p>If <code>sig.stats</code> is TRUE, it is important to know whether the
sampling weights should have a mean of 1. That is, should the standard
errors be calculated as if the number of rows in your dataset is the total
number of observations (TRUE) or as if the sum of the weights in your
dataset is the total number of observations (FALSE)?</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <code><a href="https://rdrr.io/pkg/survey/man/svyglm.html" class="external-link">svyvar()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If significance tests are not requested, there is one returned value:</p>
<dl><dt>cors</dt>
<dd><p>The correlation matrix (without rounding)</p></dd>


</dl><p>If significance tests are requested, the following are also returned:</p>
<dl><dt>p.values</dt>
<dd><p>A matrix of p values</p></dd>

<dt>t.values</dt>
<dd><p>A matrix of t values</p></dd>

<dt>std.err</dt>
<dd><p>A matrix of standard errors</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function extends the <code>survey</code> package by calculating the
correlations for user-specified variables in survey design and returning a
correlation matrix.</p>
<p>Using the <code><a href="https://rdrr.io/pkg/weights/man/wtd.cor.html" class="external-link">wtd.cor</a></code> function, this function also
returns standard errors and p-values for the correlation terms using a
sample-weighted bootstrapping procedure. While correlations do not require
distributional assumptions, hypothesis testing (i.e., \(r &gt; 0\)) does.
The appropriate way to calculate standard errors and use them to define a
probability is not straightforward in this scenario since the weighting
causes heteroskedasticity, thereby violating
an assumption inherent in the commonly used methods for converting Pearson's
correlations into t-values. The method provided here is defensible, but if
reporting in scientific publications the method should be spelled out.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>This function was designed in part on the procedure recommended by
Thomas Lumley, the author of the survey package, on
<a href="https://stackoverflow.com/questions/34418822/pearson-correlation-coefficient-in-rs-survey-package#41031088" class="external-link">Stack Overflow</a>. However, he has
not reviewed or endorsed this implementation.
All defects are attributed to the author.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/pkg/weights/man/wtd.cor.html" class="external-link">wtd.cor</a></code>, <code><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean()</a></code></p>
<p>Other survey package extensions:
<code><a href="svysd.html">svysd</a>()</code></p>
<p>Other survey tools:
<code><a href="pf_sv_test.html">pf_sv_test</a>()</code>,
<code><a href="svysd.html">svysd</a>()</code>,
<code><a href="weights_tests.html">weights_tests</a>()</code>,
<code><a href="wgttest.html">wgttest</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Jacob Long <a href="mailto:jacob.long@sc.edu">jacob.long@sc.edu</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"survey"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">api</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># Create survey design object</span></span></span>
<span class="r-in"><span> <span class="va">dstrat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>id <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, strata <span class="op">=</span> <span class="op">~</span><span class="va">stype</span>, weights <span class="op">=</span> <span class="op">~</span><span class="va">pw</span>,</span></span>
<span class="r-in"><span>                     data <span class="op">=</span> <span class="va">apistrat</span>, fpc <span class="op">=</span> <span class="op">~</span><span class="va">fpc</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co"># Print correlation matrix</span></span></span>
<span class="r-in"><span> <span class="fu">svycor</span><span class="op">(</span><span class="op">~</span><span class="va">api00</span> <span class="op">+</span> <span class="va">api99</span> <span class="op">+</span> <span class="va">dnum</span>, design <span class="op">=</span> <span class="va">dstrat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co"># Save the results, extract correlation matrix</span></span></span>
<span class="r-in"><span> <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">svycor</span><span class="op">(</span><span class="op">~</span><span class="va">api00</span> <span class="op">+</span> <span class="va">api99</span> <span class="op">+</span> <span class="va">dnum</span>, design <span class="op">=</span> <span class="va">dstrat</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">out</span><span class="op">$</span><span class="va">cors</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           api00     api99      dnum</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api00 1.0000000 0.9759047 0.2543484</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api99 0.9759047 1.0000000 0.2441910</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dnum  0.2543484 0.2441910 1.0000000</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jacob A. Long.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

