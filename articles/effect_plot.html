<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="jtools">
<title>Visualizing regression model predictions • jtools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Lato-0.4.6/font.css" rel="stylesheet">
<link href="../deps/IBM_Plex_Mono-0.4.6/font.css" rel="stylesheet">
<link href="../deps/Raleway-0.4.6/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Visualizing regression model predictions">
<meta property="og:description" content="jtools">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">jtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Documentation
  </a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--vignettes">
    <span class="fa fa-book"></span>
     
    Vignettes
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--vignettes">
    <a class="dropdown-item" href="../articles/summ.html">Tools for summarizing and visualizing regression models</a>
    <a class="dropdown-item" href="../articles/effect_plot.html">Visualizing regression model predictions</a>
    <a class="dropdown-item" href="../articles/svycor.html">Calculate correlations and correlation tables with complex survey data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jacob-long/jtools">
    <span class="fa fa-github fa-lg"></span>
     
    Github
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Visualizing regression model predictions</h1>
                        <h4 data-toc-skip class="author">Jacob Long</h4>
            
            <h4 data-toc-skip class="date">2023-07-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jacob-long/jtools/blob/HEAD/vignettes/effect_plot.Rmd" class="external-link"><code>vignettes/effect_plot.Rmd</code></a></small>
      <div class="d-none name"><code>effect_plot.Rmd</code></div>
    </div>

    
    
<p>One great way to understand what your regression model is telling you
is to look at what kinds of predictions it generates. The most
straightforward way to do so is to pick a predictor in the model and
calculate predicted values across values of that predictor, holding
everything else in the model equal. This is what Fox and Weisberg (2018)
call a “predictor effect display.”</p>
<div class="section level2">
<h2 id="linear-model-example">Linear model example<a class="anchor" aria-label="anchor" href="#linear-model-example"></a>
</h2>
<p>To illustrate, let’s create a model using the <code>mpg</code> data
from the <code>ggplot2</code> package. These data comprise information
about 234 cars over several years. We will be predicting the gas mileage
in cities (<code>cty</code>) using several variables, including engine
displacement (<code>displ</code>), model year (<code>year</code>), # of
engine cylinders (<code>cyl</code>), class of car (<code>class</code>),
and fuel type (<code>fl</code>).</p>
<p>Here’s a model summary courtesy of <code>summ</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">cty</span> <span class="op">~</span> <span class="va">displ</span> <span class="op">+</span> <span class="va">year</span> <span class="op">+</span> <span class="va">cyl</span> <span class="op">+</span> <span class="va">class</span> <span class="op">+</span> <span class="va">fl</span>, data <span class="op">=</span> <span class="va">mpg</span><span class="op">[</span><span class="va">mpg</span><span class="op">$</span><span class="va">fl</span> <span class="op">!=</span> <span class="st">"c"</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/summ.html">summ</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">MODEL INFO:</span></span></span>
<span><span class="co">## <span style="font-style: italic;">Observations:</span> 233</span></span>
<span><span class="co">## <span style="font-style: italic;">Dependent Variable:</span> cty</span></span>
<span><span class="co">## <span style="font-style: italic;">Type:</span> OLS linear regression </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">MODEL FIT:</span></span></span>
<span><span class="co">## <span style="font-style: italic;">F</span>(12,220) = 107.19, <span style="font-style: italic;">p</span> = 0.00</span></span>
<span><span class="co">## <span style="font-style: italic;">R² = </span>0.85</span></span>
<span><span class="co">## <span style="font-style: italic;">Adj. R² = </span>0.85 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-style: italic;">Standard errors: OLS</span></span></span>
<span><span class="co">## -------------------------------------------------------</span></span>
<span><span class="co">##                            Est.    S.E.   t val.      p</span></span>
<span><span class="co">## --------------------- --------- ------- -------- ------</span></span>
<span><span class="co">## (Intercept)             -193.86   50.92    -3.81   0.00</span></span>
<span><span class="co">## displ                     -1.02    0.29    -3.53   0.00</span></span>
<span><span class="co">## year                       0.12    0.03     4.52   0.00</span></span>
<span><span class="co">## cyl                       -0.85    0.20    -4.26   0.00</span></span>
<span><span class="co">## classcompact              -2.81    1.00    -2.83   0.01</span></span>
<span><span class="co">## classmidsize              -2.95    0.97    -3.05   0.00</span></span>
<span><span class="co">## classminivan              -5.08    1.05    -4.82   0.00</span></span>
<span><span class="co">## classpickup               -5.89    0.92    -6.37   0.00</span></span>
<span><span class="co">## classsubcompact           -2.63    1.01    -2.61   0.01</span></span>
<span><span class="co">## classsuv                  -5.59    0.88    -6.33   0.00</span></span>
<span><span class="co">## fle                      -11.06    0.99   -11.13   0.00</span></span>
<span><span class="co">## flp                       -8.91    0.81   -11.03   0.00</span></span>
<span><span class="co">## flr                       -7.62    0.77    -9.96   0.00</span></span>
<span><span class="co">## -------------------------------------------------------</span></span></code></pre>
<p>Let’s explore the effect of engine displacement on gas mileage:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/effect_plot.html">effect_plot</a></span><span class="op">(</span><span class="va">fit</span>, pred <span class="op">=</span> <span class="va">displ</span><span class="op">)</span></span></code></pre></div>
<p><img src="effect_plot_files/figure-html/unnamed-chunk-3-1.png" width="750"></p>
<p>To be clear, these predictions set all the continuous variables other
than <code>displ</code> to their mean value. This can be tweaked via the
<code>centered</code> argument (“none” or a vector of variables to
center are options). Factor variables are set to their base level and
logical variables are set to <code>FALSE</code>.</p>
<p>So this plot, in this case, is not <em>super</em> illuminating. Let’s
see the uncertainty around this line.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/effect_plot.html">effect_plot</a></span><span class="op">(</span><span class="va">fit</span>, pred <span class="op">=</span> <span class="va">displ</span>, interval <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="effect_plot_files/figure-html/unnamed-chunk-4-1.png" width="750"></p>
<p>Now we’re getting somewhere.</p>
<p>If you want to get a feel for how the data are distributed, you can
add what is known as a rug plot.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/effect_plot.html">effect_plot</a></span><span class="op">(</span><span class="va">fit</span>, pred <span class="op">=</span> <span class="va">displ</span>, interval <span class="op">=</span> <span class="cn">TRUE</span>, rug <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="effect_plot_files/figure-html/unnamed-chunk-5-1.png" width="750"></p>
<p>For a more direct look at how the model relates to the observed data,
you can use the <code>plot.points = TRUE</code> argument.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/effect_plot.html">effect_plot</a></span><span class="op">(</span><span class="va">fit</span>, pred <span class="op">=</span> <span class="va">displ</span>, interval <span class="op">=</span> <span class="cn">TRUE</span>, plot.points <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="effect_plot_files/figure-html/unnamed-chunk-6-1.png" width="750"></p>
<p>Now we’re really learning something about our model—and things aren’t
looking great. It seems like a simple linear model may not even be
appropriate. Let’s try fitting a polynomial for the <code>displ</code>
term to capture that curvature.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_poly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">cty</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">displ</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">year</span> <span class="op">+</span> <span class="va">cyl</span> <span class="op">+</span> <span class="va">class</span> <span class="op">+</span> <span class="va">fl</span>, data <span class="op">=</span> <span class="va">mpg</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/effect_plot.html">effect_plot</a></span><span class="op">(</span><span class="va">fit_poly</span>, pred <span class="op">=</span> <span class="va">displ</span>, interval <span class="op">=</span> <span class="cn">TRUE</span>, plot.points <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="effect_plot_files/figure-html/unnamed-chunk-7-1.png" width="750"></p>
<p>Okay, now we’re getting closer even though the predicted line
curiously grazes over the top of most of the observed data. Before we
panic, let’s introduce another feature that might clear things up.</p>
</div>
<div class="section level2">
<h2 id="partial-residuals-plots">Partial residuals plots<a class="anchor" aria-label="anchor" href="#partial-residuals-plots"></a>
</h2>
<p>In complex regressions like the one in this running example, plotting
the observed data can sometimes be relatively uninformative because the
points seem to be all over the place. While the typical effects plot
shows predicted values of <code>cty</code> across different values of
<code>displ</code>, I included included a lot of predictors besides
<code>displ</code> in this model and they may be accounting for some of
this variation. This is what <em>partial residual plots</em> are
designed to help with. Using the argument
<code>partial.residuals = TRUE</code>, what is plotted instead is the
observed data <em>with the effects of all the control variables
accounted for</em>. In other words, the value <code>cty</code> for the
observed data is based only on the values of <code>displ</code> and the
model error. Let’s take a look.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/effect_plot.html">effect_plot</a></span><span class="op">(</span><span class="va">fit_poly</span>, pred <span class="op">=</span> <span class="va">displ</span>, interval <span class="op">=</span> <span class="cn">TRUE</span>, partial.residuals <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="effect_plot_files/figure-html/unnamed-chunk-8-1.png" width="750"></p>
<p>There we go! Our polynomial term for <code>displ</code> is looking
much better now. You could tell in the previous plot without partial
residuals that the <em>shape</em> of the predictions were about right,
but the predicted line was just too high. The partial residuals set all
those controls to the same value which shifted the observations up (in
this case) to where the predictions are. That means the model does a
good job of explaining away that discrepancy and we can see more clearly
the polynomial term for <code>displ</code> works better than a linear
main effect.</p>
<p>You can learn more about the technique and theory in Fox and Weisberg
(2018). Another place to generate partial residual plots is in Fox’s
<code>effects</code> package.</p>
</div>
<div class="section level2">
<h2 id="generalized-linear-models">Generalized linear models<a class="anchor" aria-label="anchor" href="#generalized-linear-models"></a>
</h2>
<p>Plotting can be even more essential to understands models like GLMs
(e.g., logit, probit, poisson).</p>
<div class="section level3">
<h3 id="logit-and-probit">Logit and probit<a class="anchor" aria-label="anchor" href="#logit-and-probit"></a>
</h3>
<p>We’ll use the <code>bacteria</code> data from the <code>MASS</code>
package to explore binary dependent variable models. These data come
from a study in which children with a bacterial illness were provided
with either an active drug or placebo and some were given extra
encouragement to take the medicine by the doctor. These conditions are
represented by the <code>trt</code> variable. Patients were checked for
presence or absence of the bacteria (<code>y</code>) every few weeks
(<code>week</code>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">bacteria</span><span class="op">)</span></span>
<span><span class="va">l_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">trt</span> <span class="op">+</span> <span class="va">week</span>, data <span class="op">=</span> <span class="va">bacteria</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/summ.html">summ</a></span><span class="op">(</span><span class="va">l_mod</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">MODEL INFO:</span></span></span>
<span><span class="co">## <span style="font-style: italic;">Observations:</span> 220</span></span>
<span><span class="co">## <span style="font-style: italic;">Dependent Variable:</span> y</span></span>
<span><span class="co">## <span style="font-style: italic;">Type:</span> Generalized linear model</span></span>
<span><span class="co">##   <span style="font-style: italic;">Family:</span> binomial </span></span>
<span><span class="co">##   <span style="font-style: italic;">Link function:</span> logit </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">MODEL FIT:</span></span></span>
<span><span class="co">## χ²(3) = 13.57, <span style="font-style: italic;">p</span> = 0.00</span></span>
<span><span class="co">## <span style="font-style: italic;">Pseudo-R² (Cragg-Uhler)</span> = 0.10</span></span>
<span><span class="co">## <span style="font-style: italic;">Pseudo-R² (McFadden)</span> = 0.06</span></span>
<span><span class="co">## <span style="font-style: italic;">AIC</span> = 211.81, <span style="font-style: italic;">BIC</span> = 225.38 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-style: italic;">Standard errors: MLE</span></span></span>
<span><span class="co">## ------------------------------------------------</span></span>
<span><span class="co">##                      Est.   S.E.   z val.      p</span></span>
<span><span class="co">## ----------------- ------- ------ -------- ------</span></span>
<span><span class="co">## (Intercept)          2.55   0.41     6.28   0.00</span></span>
<span><span class="co">## trtdrug             -1.11   0.43    -2.60   0.01</span></span>
<span><span class="co">## trtdrug+            -0.65   0.45    -1.46   0.14</span></span>
<span><span class="co">## week                -0.12   0.04    -2.62   0.01</span></span>
<span><span class="co">## ------------------------------------------------</span></span></code></pre>
<p>Let’s check out the effect of time.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/effect_plot.html">effect_plot</a></span><span class="op">(</span><span class="va">l_mod</span>, pred <span class="op">=</span> <span class="va">week</span>, interval <span class="op">=</span> <span class="cn">TRUE</span>, y.label <span class="op">=</span> <span class="st">"% testing positive"</span><span class="op">)</span></span></code></pre></div>
<p><img src="effect_plot_files/figure-html/unnamed-chunk-10-1.png" width="750"></p>
<p>As time goes on, fewer patients test positive for the bacteria.</p>
</div>
<div class="section level3">
<h3 id="poisson">Poisson<a class="anchor" aria-label="anchor" href="#poisson"></a>
</h3>
<p>For a poisson example, we’ll use the <code>Insurance</code> data from
the <code>MASS</code> package. We’re predicting the number of car
insurance claims for people with different combinations of car type,
region, and age. While <code>Age</code> is an ordered factor, I’ll
convert it to a continuous variable for the sake of demonstration.
<code>Claims</code> is a count variable, so the poisson distribution is
an appropriate modeling approach.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Insurance</span><span class="op">)</span></span>
<span><span class="va">Insurance</span><span class="op">$</span><span class="va">age_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Insurance</span><span class="op">$</span><span class="va">Age</span><span class="op">)</span></span>
<span><span class="va">p_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Claims</span> <span class="op">~</span> <span class="va">District</span> <span class="op">+</span> <span class="va">Group</span> <span class="op">+</span> <span class="va">age_n</span>, data <span class="op">=</span> <span class="va">Insurance</span>,</span>
<span>             offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Holders</span><span class="op">)</span>, family <span class="op">=</span> <span class="va">poisson</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/summ.html">summ</a></span><span class="op">(</span><span class="va">p_mod</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">MODEL INFO:</span></span></span>
<span><span class="co">## <span style="font-style: italic;">Observations:</span> 64</span></span>
<span><span class="co">## <span style="font-style: italic;">Dependent Variable:</span> Claims</span></span>
<span><span class="co">## <span style="font-style: italic;">Type:</span> Generalized linear model</span></span>
<span><span class="co">##   <span style="font-style: italic;">Family:</span> poisson </span></span>
<span><span class="co">##   <span style="font-style: italic;">Link function:</span> log </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">MODEL FIT:</span></span></span>
<span><span class="co">## χ²(7) = 184.71, <span style="font-style: italic;">p</span> = 0.00</span></span>
<span><span class="co">## <span style="font-style: italic;">Pseudo-R² (Cragg-Uhler)</span> = 0.94</span></span>
<span><span class="co">## <span style="font-style: italic;">Pseudo-R² (McFadden)</span> = 0.33</span></span>
<span><span class="co">## <span style="font-style: italic;">AIC</span> = 384.87, <span style="font-style: italic;">BIC</span> = 402.14 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-style: italic;">Standard errors: MLE</span></span></span>
<span><span class="co">## ------------------------------------------------</span></span>
<span><span class="co">##                      Est.   S.E.   z val.      p</span></span>
<span><span class="co">## ----------------- ------- ------ -------- ------</span></span>
<span><span class="co">## (Intercept)         -1.37   0.07   -20.16   0.00</span></span>
<span><span class="co">## District2            0.03   0.04     0.60   0.55</span></span>
<span><span class="co">## District3            0.04   0.05     0.76   0.45</span></span>
<span><span class="co">## District4            0.23   0.06     3.80   0.00</span></span>
<span><span class="co">## Group.L              0.43   0.05     8.71   0.00</span></span>
<span><span class="co">## Group.Q              0.00   0.04     0.11   0.91</span></span>
<span><span class="co">## Group.C             -0.03   0.03    -0.88   0.38</span></span>
<span><span class="co">## age_n               -0.18   0.02    -9.56   0.00</span></span>
<span><span class="co">## ------------------------------------------------</span></span></code></pre>
<p>Okay, age is a significant predictor of the number of claims. Note
that we have an offset term, so the count we’re predicting is more like
a <em>rate</em>. That is, we are modeling how many claims there are
adjusting for the amount of policyholders.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/effect_plot.html">effect_plot</a></span><span class="op">(</span><span class="va">p_mod</span>, pred <span class="op">=</span> <span class="va">age_n</span>, interval <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="effect_plot_files/figure-html/unnamed-chunk-12-1.png" width="750"></p>
<p>So what does this mean? Critical is understanding the scale of the
outcome variable. Because of the offset, we must pick a value of the
offset to generate predictions at. <code>effect_plot</code>, by default,
sets the offset at 1. That means the predictions you see can be
interpreted as a percentage; for every policyholder, there are between
0.16 and 0.10 claims. We can also see that as age goes up, the
proportion of policyholders with claims goes down.</p>
<p>Now let’s take a look at the observed data…</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/effect_plot.html">effect_plot</a></span><span class="op">(</span><span class="va">p_mod</span>, pred <span class="op">=</span> <span class="va">age_n</span>, interval <span class="op">=</span> <span class="cn">TRUE</span>, plot.points <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="effect_plot_files/figure-html/unnamed-chunk-13-1.png" width="750"></p>
<p>Oops! That doesn’t look right, does it? The problem here is the
offset. Some age groups have many more policyholders than others and
they all have more than 1, which is what we set the offset to for the
predictions. This is a more extreme version of the problem we had the
with the linear model previously, so let’s use the same solution:
partial residuals.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/effect_plot.html">effect_plot</a></span><span class="op">(</span><span class="va">p_mod</span>, pred <span class="op">=</span> <span class="va">age_n</span>, interval <span class="op">=</span> <span class="cn">TRUE</span>, partial.residuals <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="effect_plot_files/figure-html/unnamed-chunk-14-1.png" width="750"></p>
<p>Now we’re getting somewhere. The only difficulty in interpreting this
is the overlapping points. Let’s use the <code>jitter</code> argument to
add a random bit of noise to each observation so we can see just how
many points there are more clearly.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/effect_plot.html">effect_plot</a></span><span class="op">(</span><span class="va">p_mod</span>, pred <span class="op">=</span> <span class="va">age_n</span>, interval <span class="op">=</span> <span class="cn">TRUE</span>, partial.residuals <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            jitter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="effect_plot_files/figure-html/unnamed-chunk-15-1.png" width="750"></p>
<p>Because I didn’t want to alter the height of the points, I provided a
vector with both 0.1 (referring to the horizontal position) and 0
(referring to the vertical position) to the <code>jitter</code>
argument.</p>
</div>
</div>
<div class="section level2">
<h2 id="categorical-predictors">Categorical predictors<a class="anchor" aria-label="anchor" href="#categorical-predictors"></a>
</h2>
<p>These methods don’t work as clearly when the predictor isn’t
continuous. Luckily, <code>effect_plot</code> automatically handles such
cases and offers a number of options for visualizing effects of
categorical predictors.</p>
<p>Using our first example, predicting gas mileage, let’s focus on the
class of car as predictor.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/effect_plot.html">effect_plot</a></span><span class="op">(</span><span class="va">fit</span>, pred <span class="op">=</span> <span class="va">fl</span>, interval <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="effect_plot_files/figure-html/unnamed-chunk-16-1.png" width="750"></p>
<p>We can clearly see how diesel (“d”) is associated with the best
mileage by far and ethanol (“e”) the worst by a little bit.</p>
<p>You can plot the observed data in these types of plots as well:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/effect_plot.html">effect_plot</a></span><span class="op">(</span><span class="va">fit</span>, pred <span class="op">=</span> <span class="va">fl</span>, interval <span class="op">=</span> <span class="cn">TRUE</span>, plot.points <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            jitter <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="effect_plot_files/figure-html/unnamed-chunk-17-1.png" width="750"></p>
<p>These seem a bit far off from the predictions. Let’s see if the
partial residuals are a little more in line with expectations.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/effect_plot.html">effect_plot</a></span><span class="op">(</span><span class="va">fit</span>, pred <span class="op">=</span> <span class="va">fl</span>, interval <span class="op">=</span> <span class="cn">TRUE</span>, partial.residuals <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            jitter <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="effect_plot_files/figure-html/unnamed-chunk-18-1.png" width="750"></p>
<p>Now things make a little more sense and you can see the range of
possibilities within each category after accounting for model year and
so on. Diesel in particular seems have too few and too spaced out
observations to take overly seriously.</p>
<p>Let’s also look at the bacteria example, using treatment type as the
predictor of interest.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/effect_plot.html">effect_plot</a></span><span class="op">(</span><span class="va">l_mod</span>, pred <span class="op">=</span> <span class="va">trt</span>, interval <span class="op">=</span> <span class="cn">TRUE</span>, y.label <span class="op">=</span> <span class="st">"% testing positive"</span><span class="op">)</span></span></code></pre></div>
<p><img src="effect_plot_files/figure-html/unnamed-chunk-19-1.png" width="750"></p>
<p>Now we can see that receiving the drug is clearly superior to
placebo, but the drug plus encouragement is not only no better than the
drug alone, it’s hardly better than placebo. Of course, we can also tell
that the confidence intervals are fairly wide, so I won’t say that these
data tell us anything definitively besides the superiority of the drug
over placebo.</p>
<p>You may also want to use lines to convey the ordered nature of this
predictor.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/effect_plot.html">effect_plot</a></span><span class="op">(</span><span class="va">l_mod</span>, pred <span class="op">=</span> <span class="va">trt</span>, interval <span class="op">=</span> <span class="cn">TRUE</span>, y.label <span class="op">=</span> <span class="st">"% testing positive"</span>,</span>
<span>            cat.geom <span class="op">=</span> <span class="st">"line"</span><span class="op">)</span></span></code></pre></div>
<p><img src="effect_plot_files/figure-html/unnamed-chunk-20-1.png" width="750"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jacob A. Long.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
