<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Test whether sampling weights are needed — wgttest • jtools</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Test whether sampling weights are needed — wgttest"><meta property="og:description" content="Use the DuMouchel-Duncan (1983) test to assess the need for sampling weights
in your linear regression analysis."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.5.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Documentation
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/summ.html">Tools for summarizing and visualizing regression models</a>
    </li>
    <li>
      <a href="../articles/effect_plot.html">Visualizing regression model predictions</a>
    </li>
    <li>
      <a href="../articles/svycor.html">Calculate correlations and correlation tables with complex survey data</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/jacob-long/jtools" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    Github
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Test whether sampling weights are needed</h1>
    <small class="dont-index">Source: <a href="https://github.com/jacob-long/jtools/blob/HEAD/R/svytools.R" class="external-link"><code>R/svytools.R</code></a></small>
    <div class="hidden name"><code>wgttest.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Use the DuMouchel-Duncan (1983) test to assess the need for sampling weights
in your linear regression analysis.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">wgttest</span><span class="op">(</span>
  <span class="va">model</span>,
  <span class="va">weights</span>,
  data <span class="op">=</span> <span class="cn">NULL</span>,
  model_output <span class="op">=</span> <span class="cn">FALSE</span>,
  test <span class="op">=</span> <span class="cn">NULL</span>,
  digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"jtools-digits"</span>, default <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>model</dt>
<dd><p>The unweighted linear model (must be <code>lm</code>,
<code>glm</code>, see details for other types) you want to check.</p></dd>
<dt>weights</dt>
<dd><p>The name of the weights column in <code>model</code>'s data frame
or a vector of weights equal in length to the number of observations
included in <code>model</code>.</p></dd>
<dt>data</dt>
<dd><p>The data frame with the data fed to the fitted model and the
weights</p></dd>
<dt>model_output</dt>
<dd><p>Should a summary of the model with weights as predictor
be printed? Default is FALSE since the output can be very long for
complex models.</p></dd>
<dt>test</dt>
<dd><p>Which type of test should be used in the ANOVA? The default,
<code>NULL</code>, chooses based on the model type ("F" for linear models).
This argument is passed to <code>anova</code>.</p></dd>
<dt>digits</dt>
<dd><p>An integer specifying the number of digits past the decimal to
report in the output. Default is 3. You can change the default number of
digits for all jtools functions with
<code>options("jtools-digits" = digits)</code> where digits is the desired number.</p></dd>
</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>This is designed to be similar to the <code>wgttest</code> macro for Stata
(<a href="http://fmwww.bc.edu/repec/bocode/w/wgttest.html" class="external-link">http://fmwww.bc.edu/repec/bocode/w/wgttest.html</a>). This method,
advocated for by DuMouchel and Duncan (1983), is fairly straightforward. To
decide whether weights are needed, the weights are added to the linear model
as a predictor and interaction with each other predictor. Then, an omnibus
test of significance is performed to compare the weights-added model to the
original; if insignificant, weights are not significantly related to the
result and you can use the more efficient estimation from unweighted OLS.</p>
<p>It can be helpful to look at the created model using
<code>model_output = TRUE</code>
to see which variables might be the ones affected by inclusion of weights.</p>
<p>This test can support most GLMs in addition to LMs, a use validated by
Nordberg (1989). This, to my knowledge, is different from the Stata macro.
It does not work for mixed models (e.g., <code>lmer</code> or <code>lme</code>) though
it could plausibly be
implemented. However, there is no scholarly consensus how to properly
incorporate weights into mixed models. There are other types of models that
may work, but have not been tested. The function is designed to be
compatible with as many model types as possible, but the user should be
careful to make sure s/he understands whether this type of test is
appropriate for the model being considered. DuMouchel and Duncan (1983) were
only thinking about linear regression when the test was conceived.
Nordberg (1989) validated its use with generalized linear models, but to
this author's knowledge it has not been tested with other model types.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>DuMouchel, W. H. &amp; Duncan, D.J. (1983). Using sample survey weights in
multiple regression analyses of stratified samples. <em>Journal of the
American Statistical Association</em>, <em>78</em>. 535-543.</p>
<p>Nordberg, L. (1989). Generalized linear modeling of sample survey data.
<em>Journal of Official Statistics; Stockholm</em>, <em>5</em>, 223–239.</p>
<p>Winship, C. &amp; Radbill, L. (1994). Sampling weights and regression
analysis. <em>Sociological Methods and Research</em>, <em>23</em>, 230-257.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other survey tools: 
<code><a href="pf_sv_test.html">pf_sv_test</a>()</code>,
<code><a href="svycor.html">svycor</a>()</code>,
<code><a href="svysd.html">svysd</a>()</code>,
<code><a href="weights_tests.html">weights_tests</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># First, let's create some fake sampling weights</span></span>
<span class="r-in"><span class="va">wts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># Create model</span></span>
<span class="r-in"><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Income</span> <span class="op">~</span> <span class="va">Frost</span> <span class="op">+</span> <span class="va">Illiteracy</span> <span class="op">+</span> <span class="va">Murder</span>,</span>
<span class="r-in">          data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">state.x77</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># See if the weights change the model</span></span>
<span class="r-in"><span class="fu">wgttest</span><span class="op">(</span><span class="va">fit</span>, weights <span class="op">=</span> <span class="va">wts</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DuMouchel-Duncan test of model change with weights</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F(4,42) = 0.908</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p = 0.468</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lower p values indicate greater influence of the weights.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># With a GLM</span></span>
<span class="r-in"><span class="va">wts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span class="r-in"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1</span>, <span class="fl">.5</span><span class="op">)</span></span>
<span class="r-in"><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">wgttest</span><span class="op">(</span><span class="va">fit</span>, <span class="va">wts</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DuMouchel-Duncan test of model change with weights</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Deviance (2) = 0.625</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p = 0.732</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lower p values indicate greater influence of the weights.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span class="co">## Can specify test manually</span></span>
<span class="r-in"><span class="fu">wgttest</span><span class="op">(</span><span class="va">fit</span>, weights <span class="op">=</span> <span class="va">wts</span>, test <span class="op">=</span> <span class="st">"Rao"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DuMouchel-Duncan test of model change with weights</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Rao (2,96) = 0.624</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p = 0.732</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lower p values indicate greater influence of the weights.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Quasi family is treated differently than likelihood-based</span></span>
<span class="r-in"><span class="co">## Dobson (1990) Page 93: Randomized Controlled Trial (plus some extra values):</span></span>
<span class="r-in"><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">18</span>,<span class="fl">17</span>,<span class="fl">15</span>,<span class="fl">20</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">25</span>,<span class="fl">13</span>,<span class="fl">12</span>,<span class="fl">18</span>,<span class="fl">17</span>,<span class="fl">15</span>,<span class="fl">20</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">25</span>,<span class="fl">13</span>,<span class="fl">12</span><span class="op">)</span></span>
<span class="r-in"><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html" class="external-link">gl</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">18</span><span class="op">)</span></span>
<span class="r-in"><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html" class="external-link">gl</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">6</span><span class="op">)</span></span>
<span class="r-in"><span class="va">glm.D93</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">counts</span> <span class="op">~</span> <span class="va">outcome</span> <span class="op">+</span> <span class="va">treatment</span>, family <span class="op">=</span> <span class="va">quasipoisson</span><span class="op">)</span></span>
<span class="r-in"><span class="va">wts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">wgttest</span><span class="op">(</span><span class="va">glm.D93</span>, weights <span class="op">=</span> <span class="va">wts</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DuMouchel-Duncan test of model change with weights</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F(5,8) = 0.167</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p = 0.968</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lower p values indicate greater influence of the weights.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jacob A. Long.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

